import{r as P}from"./index.Cd_vQiNd.js";var re={exports:{}},F={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Se;function it(){if(Se)return F;Se=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,s,o){var i=null;if(o!==void 0&&(i=""+o),s.key!==void 0&&(i=""+s.key),"key"in s){o={};for(var c in s)c!=="key"&&(o[c]=s[c])}else o=s;return s=o.ref,{$$typeof:t,type:r,key:i,ref:s!==void 0?s:null,props:o}}return F.Fragment=e,F.jsx=n,F.jsxs=n,F}var be;function ct(){return be||(be=1,re.exports=it()),re.exports}var N=ct();const Be={arabic:"ar",armenian:"am",bulgarian:"bg",czech:"cz",danish:"dk",dutch:"nl",english:"en",finnish:"fi",french:"fr",german:"de",greek:"gr",hungarian:"hu",indian:"in",indonesian:"id",irish:"ie",italian:"it",lithuanian:"lt",nepali:"np",norwegian:"no",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"rs",slovenian:"ru",spanish:"es",swedish:"se",tamil:"ta",turkish:"tr",ukrainian:"uk",sanskrit:"sk"},at={dutch:/[^A-Za-zàèéìòóù0-9_'-]+/gim,english:/[^A-Za-zàèéìòóù0-9_'-]+/gim,french:/[^a-z0-9äâàéèëêïîöôùüûœç-]+/gim,italian:/[^A-Za-zàèéìòóù0-9_'-]+/gim,norwegian:/[^a-z0-9_æøåÆØÅäÄöÖüÜ]+/gim,portuguese:/[^a-z0-9à-úÀ-Ú]/gim,russian:/[^a-z0-9а-яА-ЯёЁ]+/gim,spanish:/[^a-z0-9A-Zá-úÁ-ÚñÑüÜ]+/gim,swedish:/[^a-z0-9_åÅäÄöÖüÜ-]+/gim,german:/[^a-z0-9A-ZäöüÄÖÜß]+/gim,finnish:/[^a-z0-9äöÄÖ]+/gim,danish:/[^a-z0-9æøåÆØÅ]+/gim,hungarian:/[^a-z0-9áéíóöőúüűÁÉÍÓÖŐÚÜŰ]+/gim,romanian:/[^a-z0-9ăâîșțĂÂÎȘȚ]+/gim,serbian:/[^a-z0-9čćžšđČĆŽŠĐ]+/gim,turkish:/[^a-z0-9çÇğĞıİöÖşŞüÜ]+/gim,lithuanian:/[^a-z0-9ąčęėįšųūžĄČĘĖĮŠŲŪŽ]+/gim,arabic:/[^a-z0-9أ-ي]+/gim,nepali:/[^a-z0-9अ-ह]+/gim,irish:/[^a-z0-9áéíóúÁÉÍÓÚ]+/gim,indian:/[^a-z0-9अ-ह]+/gim,armenian:/[^a-z0-9ա-ֆ]+/gim,greek:/[^a-z0-9α-ωά-ώ]+/gim,indonesian:/[^a-z0-9]+/gim,ukrainian:/[^a-z0-9а-яА-ЯіїєІЇЄ]+/gim,slovenian:/[^a-z0-9čžšČŽŠ]+/gim,bulgarian:/[^a-z0-9а-яА-Я]+/gim,tamil:/[^a-z0-9அ-ஹ]+/gim,sanskrit:/[^a-z0-9A-Zāīūṛḷṃṁḥśṣṭḍṇṅñḻḹṝ]+/gim,czech:/[^A-Z0-9a-zěščřžýáíéúůóťďĚŠČŘŽÝÁÍÉÓÚŮŤĎ-]+/gim},le=Object.keys(Be);function lt(t){return t!==void 0&&le.includes(t)?Be[t]:void 0}const ut=Date.now().toString().slice(5);let ft=0;const Ie=BigInt(1e3),Ne=BigInt(1e6),we=BigInt(1e9),se=65535;function Ve(t,e){if(e.length<se)Array.prototype.push.apply(t,e);else{const n=e.length;for(let r=0;r<n;r+=se)Array.prototype.push.apply(t,e.slice(r,r+se))}}function dt(t,...e){return t.replace(/%(?:(?<position>\d+)\$)?(?<width>-?\d*\.?\d*)(?<type>[dfs])/g,function(...n){const r=n[n.length-1],{width:s,type:o,position:i}=r,c=i?e[Number.parseInt(i)-1]:e.shift(),a=s===""?0:Number.parseInt(s);switch(o){case"d":return c.toString().padStart(a,"0");case"f":{let l=c;const[f,u]=s.split(".").map(d=>Number.parseFloat(d));return typeof u=="number"&&u>=0&&(l=l.toFixed(u)),typeof f=="number"&&f>=0?l.toString().padStart(a,"0"):l.toString()}case"s":return a<0?c.toString().padEnd(-a," "):c.toString().padStart(a," ");default:return c}})}function ht(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}function pt(){return typeof process<"u"&&process.release&&process.release.name==="node"}function Te(){return BigInt(Math.floor(performance.now()*1e6))}function ue(t){return typeof t=="number"&&(t=BigInt(t)),t<Ie?`${t}ns`:t<Ne?`${t/Ie}μs`:t<we?`${t/Ne}ms`:`${t/we}s`}function U(){return ht()?Te():pt()||typeof process<"u"&&typeof process?.hrtime?.bigint=="function"?process.hrtime.bigint():typeof performance<"u"?Te():BigInt(0)}function We(){return`${ut}-${ft++}`}function oe(t,e){return Object.hasOwn===void 0?Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0:Object.hasOwn(t,e)?t[e]:void 0}function $e(t,e){return e[1]===t[1]?t[0]-e[0]:e[1]-t[1]}function gt(t){if(t.length===0)return[];if(t.length===1)return t[0];for(let n=1;n<t.length;n++)if(t[n].length<t[0].length){const r=t[0];t[0]=t[n],t[n]=r}const e=new Map;for(const n of t[0])e.set(n,1);for(let n=1;n<t.length;n++){let r=0;for(const s of t[n]){const o=e.get(s);o===n&&(e.set(s,o+1),r++)}if(r===0)return[]}return t[0].filter(n=>{const r=e.get(n);return r!==void 0&&e.set(n,0),r===t.length})}function Ge(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const o=e[s],i=o.split(".");let c=t;const a=i.length;for(let l=0;l<a;l++)if(c=c[i[l]],typeof c=="object"){if(c!==null&&"lat"in c&&"lon"in c&&typeof c.lat=="number"&&typeof c.lon=="number"){c=n[o]=c;break}else if(!Array.isArray(c)&&c!==null&&l===a-1){c=void 0;break}}else if((c===null||typeof c!="object")&&l<a-1){c=void 0;break}typeof c<"u"&&(n[o]=c)}return n}function fe(t,e){return Ge(t,[e])[e]}const mt={cm:.01,m:1,km:1e3,ft:.3048,yd:.9144,mi:1609.344};function Je(t,e){const n=mt[e];if(n===void 0)throw new Error(T("INVALID_DISTANCE_SUFFIX",t).message);return t*n}function Ye(t,e){t.hits=t.hits.map(n=>({...n,document:{...n.document,...e.reduce((r,s)=>{const o=s.split("."),i=o.pop();let c=r;for(const a of o)c[a]=c[a]??{},c=c[a];return c[i]=null,r},n.document)}}))}function H(t){return Array.isArray(t)?t.some(e=>H(e)):t?.constructor?.name==="AsyncFunction"}const Oe="intersection"in new Set;function xe(...t){if(t.length===0)return new Set;if(t.length===1)return t[0];if(t.length===2){const r=t[0],s=t[1];if(Oe)return r.intersection(s);const o=new Set,i=r.size<s.size?r:s,c=i===r?s:r;for(const a of i)c.has(a)&&o.add(a);return o}const e={index:0,size:t[0].size};for(let r=1;r<t.length;r++)t[r].size<e.size&&(e.index=r,e.size=t[r].size);if(Oe){let r=t[e.index];for(let s=0;s<t.length;s++)s!==e.index&&(r=r.intersection(t[s]));return r}const n=t[e.index];for(let r=0;r<t.length;r++){if(r===e.index)continue;const s=t[r];for(const o of n)s.has(o)||n.delete(o)}return n}const yt="union"in new Set;function $(t,e){return yt?t?t.union(e):e:t?new Set([...t,...e]):new Set(e)}function St(t,e){const n=new Set;for(const r of t)e.has(r)||n.add(r);return n}const bt=le.join(`
 - `),It={NO_LANGUAGE_WITH_CUSTOM_TOKENIZER:"Do not pass the language option to create when using a custom tokenizer.",LANGUAGE_NOT_SUPPORTED:`Language "%s" is not supported.
Supported languages are:
 - ${bt}`,INVALID_STEMMER_FUNCTION_TYPE:"config.stemmer property must be a function.",MISSING_STEMMER:'As of version 1.0.0 @orama/orama does not ship non English stemmers by default. To solve this, please explicitly import and specify the "%s" stemmer from the package @orama/stemmers. See https://docs.orama.com/docs/orama-js/text-analysis/stemming for more information.',CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY:"Custom stop words array must only contain strings.",UNSUPPORTED_COMPONENT:'Unsupported component "%s".',COMPONENT_MUST_BE_FUNCTION:'The component "%s" must be a function.',COMPONENT_MUST_BE_FUNCTION_OR_ARRAY_FUNCTIONS:'The component "%s" must be a function or an array of functions.',INVALID_SCHEMA_TYPE:'Unsupported schema type "%s" at "%s". Expected "string", "boolean" or "number" or array of them.',DOCUMENT_ID_MUST_BE_STRING:'Document id must be of type "string". Got "%s" instead.',DOCUMENT_ALREADY_EXISTS:'A document with id "%s" already exists.',DOCUMENT_DOES_NOT_EXIST:'A document with id "%s" does not exists.',MISSING_DOCUMENT_PROPERTY:'Missing searchable property "%s".',INVALID_DOCUMENT_PROPERTY:'Invalid document property "%s": expected "%s", got "%s"',UNKNOWN_INDEX:'Invalid property name "%s". Expected a wildcard string ("*") or array containing one of the following properties: %s',INVALID_BOOST_VALUE:"Boost value must be a number greater than, or less than 0.",INVALID_FILTER_OPERATION:"You can only use one operation per filter, you requested %d.",SCHEMA_VALIDATION_FAILURE:'Cannot insert document due schema validation failure on "%s" property.',INVALID_SORT_SCHEMA_TYPE:'Unsupported sort schema type "%s" at "%s". Expected "string" or "number".',CANNOT_SORT_BY_ARRAY:'Cannot configure sort for "%s" because it is an array (%s).',UNABLE_TO_SORT_ON_UNKNOWN_FIELD:'Unable to sort on unknown field "%s". Allowed fields: %s',SORT_DISABLED:"Sort is disabled. Please read the documentation at https://docs.orama.com/docs/orama-js for more information.",UNKNOWN_GROUP_BY_PROPERTY:'Unknown groupBy property "%s".',INVALID_GROUP_BY_PROPERTY:'Invalid groupBy property "%s". Allowed types: "%s", but given "%s".',UNKNOWN_FILTER_PROPERTY:'Unknown filter property "%s".',UNKNOWN_VECTOR_PROPERTY:'Unknown vector property "%s". Make sure the property exists in the schema and is configured as a vector.',INVALID_VECTOR_SIZE:'Vector size must be a number greater than 0. Got "%s" instead.',INVALID_VECTOR_VALUE:'Vector value must be a number greater than 0. Got "%s" instead.',INVALID_INPUT_VECTOR:`Property "%s" was declared as a %s-dimensional vector, but got a %s-dimensional vector instead.
Input vectors must be of the size declared in the schema, as calculating similarity between vectors of different sizes can lead to unexpected results.`,WRONG_SEARCH_PROPERTY_TYPE:'Property "%s" is not searchable. Only "string" properties are searchable.',FACET_NOT_SUPPORTED:`Facet doens't support the type "%s".`,INVALID_DISTANCE_SUFFIX:'Invalid distance suffix "%s". Valid suffixes are: cm, m, km, mi, yd, ft.',INVALID_SEARCH_MODE:'Invalid search mode "%s". Valid modes are: "fulltext", "vector", "hybrid".',MISSING_VECTOR_AND_SECURE_PROXY:"No vector was provided and no secure proxy was configured. Please provide a vector or configure an Orama Secure Proxy to perform hybrid search.",MISSING_TERM:'"term" is a required parameter when performing hybrid search. Please provide a search term.',INVALID_VECTOR_INPUT:'Invalid "vector" property. Expected an object with "value" and "property" properties, but got "%s" instead.',PLUGIN_CRASHED:"A plugin crashed during initialization. Please check the error message for more information:",PLUGIN_SECURE_PROXY_NOT_FOUND:`Could not find '@orama/secure-proxy-plugin' installed in your Orama instance.
Please install it before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,PLUGIN_SECURE_PROXY_MISSING_CHAT_MODEL:`Could not find a chat model defined in the secure proxy plugin configuration.
Please provide a chat model before proceeding with creating an answer session.
Read more at https://docs.orama.com/docs/orama-js/plugins/plugin-secure-proxy#plugin-secure-proxy
`,ANSWER_SESSION_LAST_MESSAGE_IS_NOT_ASSISTANT:"The last message in the session is not an assistant message. Cannot regenerate non-assistant messages.",PLUGIN_COMPONENT_CONFLICT:'The component "%s" is already defined. The plugin "%s" is trying to redefine it.'};function T(t,...e){const n=new Error(dt(It[t]??`Unsupported Orama Error code: ${t}`,...e));return n.code=t,"captureStackTrace"in Error.prototype&&Error.captureStackTrace(n),n}function Nt(t){return{raw:Number(t),formatted:ue(t)}}function wt(t){if(t.id){if(typeof t.id!="string")throw T("DOCUMENT_ID_MUST_BE_STRING",typeof t.id);return t.id}return We()}function He(t,e){for(const[n,r]of Object.entries(e)){const s=t[n];if(!(typeof s>"u")&&!(r==="geopoint"&&typeof s=="object"&&typeof s.lon=="number"&&typeof s.lat=="number")&&!(r==="enum"&&(typeof s=="string"||typeof s=="number"))){if(r==="enum[]"&&Array.isArray(s)){const o=s.length;for(let i=0;i<o;i++)if(typeof s[i]!="string"&&typeof s[i]!="number")return n+"."+i;continue}if(B(r)){const o=Ke(r);if(!Array.isArray(s)||s.length!==o)throw T("INVALID_INPUT_VECTOR",n,o,s.length);continue}if(de(r)){if(!Array.isArray(s))return n;const o=qe(r),i=s.length;for(let c=0;c<i;c++)if(typeof s[c]!==o)return n+"."+c;continue}if(typeof r=="object"){if(!s||typeof s!="object")return n;const o=He(s,r);if(o)return n+"."+o;continue}if(typeof s!==r)return n}}}const Tt={string:!1,number:!1,boolean:!1,enum:!1,geopoint:!1,"string[]":!0,"number[]":!0,"boolean[]":!0,"enum[]":!0},Ot={"string[]":"string","number[]":"number","boolean[]":"boolean","enum[]":"enum"};function B(t){return typeof t=="string"&&/^vector\[\d+\]$/.test(t)}function de(t){return typeof t=="string"&&Tt[t]}function qe(t){return Ot[t]}function Ke(t){const e=Number(t.slice(7,-1));switch(!0){case isNaN(e):throw T("INVALID_VECTOR_VALUE",t);case e<=0:throw T("INVALID_VECTOR_SIZE",t);default:return e}}function xt(){return{idToInternalId:new Map,internalIdToId:[],save:Dt,load:At}}function Dt(t){return{internalIdToId:t.internalIdToId}}function At(t,e){const{internalIdToId:n}=e;t.internalDocumentIDStore.idToInternalId.clear(),t.internalDocumentIDStore.internalIdToId=[];const r=n.length;for(let s=0;s<r;s++){const o=n[s];t.internalDocumentIDStore.idToInternalId.set(o,s+1),t.internalDocumentIDStore.internalIdToId.push(o)}}function _(t,e){if(typeof e=="string"){const n=t.idToInternalId.get(e);if(n)return n;const r=t.idToInternalId.size+1;return t.idToInternalId.set(e,r),t.internalIdToId.push(e),r}return e>t.internalIdToId.length?_(t,e.toString()):e}function q(t,e){if(t.internalIdToId.length<e)throw new Error(`Invalid internalId ${e}`);return t.internalIdToId[e-1]}function Et(t,e){return{sharedInternalDocumentStore:e,docs:{},count:0}}function vt(t,e){const n=_(t.sharedInternalDocumentStore,e);return t.docs[n]}function _t(t,e){const n=e.length,r=Array.from({length:n});for(let s=0;s<n;s++){const o=_(t.sharedInternalDocumentStore,e[s]);r[s]=t.docs[o]}return r}function Pt(t){return t.docs}function Rt(t,e,n,r){return typeof t.docs[n]<"u"?!1:(t.docs[n]=r,t.count++,!0)}function kt(t,e){const n=_(t.sharedInternalDocumentStore,e);return typeof t.docs[n]>"u"?!1:(delete t.docs[n],t.count--,!0)}function Mt(t){return t.count}function Lt(t,e){const n=e;return{docs:n.docs,count:n.count,sharedInternalDocumentStore:t}}function Ct(t){return{docs:t.docs,count:t.count}}function Ut(){return{create:Et,get:vt,getMultiple:_t,getAll:Pt,store:Rt,remove:kt,count:Mt,load:Lt,save:Ct}}const zt=["beforeInsert","afterInsert","beforeRemove","afterRemove","beforeUpdate","afterUpdate","beforeUpsert","afterUpsert","beforeSearch","afterSearch","beforeInsertMultiple","afterInsertMultiple","beforeRemoveMultiple","afterRemoveMultiple","beforeUpdateMultiple","afterUpdateMultiple","beforeUpsertMultiple","afterUpsertMultiple","beforeLoad","afterLoad","afterCreate"];function Ft(t,e){const n=[],r=t.plugins?.length;if(!r)return n;for(let s=0;s<r;s++)try{const o=t.plugins[s];typeof o[e]=="function"&&n.push(o[e])}catch(o){throw console.error("Caught error in getAllPluginsByHook:",o),T("PLUGIN_CRASHED")}return n}const jt=["tokenizer","index","documentsStore","sorter"],De=["validateSchema","getDocumentIndexId","getDocumentProperties","formatElapsedTime"];function he(t,e,n,r,s){if(t.some(H))return(async()=>{for(const i of t)await i(e,n,r,s)})();for(const i of t)i(e,n,r,s)}function pe(t,e,n,r){if(t.some(H))return(async()=>{for(const o of t)await o(e,n,r)})();for(const o of t)o(e,n,r)}function Bt(t,e){if(t.some(H))return(async()=>{for(const r of t)await r(e)})();for(const r of t)r(e)}class E{k;v;l=null;r=null;h=1;constructor(e,n){this.k=e,this.v=new Set(n)}updateHeight(){this.h=Math.max(E.getHeight(this.l),E.getHeight(this.r))+1}static getHeight(e){return e?e.h:0}getBalanceFactor(){return E.getHeight(this.l)-E.getHeight(this.r)}rotateLeft(){const e=this.r;return this.r=e.l,e.l=this,this.updateHeight(),e.updateHeight(),e}rotateRight(){const e=this.l;return this.l=e.r,e.r=this,this.updateHeight(),e.updateHeight(),e}toJSON(){return{k:this.k,v:Array.from(this.v),l:this.l?this.l.toJSON():null,r:this.r?this.r.toJSON():null,h:this.h}}static fromJSON(e){const n=new E(e.k,e.v);return n.l=e.l?E.fromJSON(e.l):null,n.r=e.r?E.fromJSON(e.r):null,n.h=e.h,n}}class K{root=null;insertCount=0;constructor(e,n){e!==void 0&&n!==void 0&&(this.root=new E(e,n))}insert(e,n,r=1e3){this.root=this.insertNode(this.root,e,n,r)}insertMultiple(e,n,r=1e3){for(const s of n)this.insert(e,s,r)}rebalance(){this.root&&(this.root=this.rebalanceNode(this.root))}toJSON(){return{root:this.root?this.root.toJSON():null,insertCount:this.insertCount}}static fromJSON(e){const n=new K;return n.root=e.root?E.fromJSON(e.root):null,n.insertCount=e.insertCount||0,n}insertNode(e,n,r,s){if(e===null)return new E(n,[r]);const o=[];let i=e,c=null;for(;i!==null;)if(o.push({parent:c,node:i}),n<i.k)if(i.l===null){i.l=new E(n,[r]),o.push({parent:i,node:i.l});break}else c=i,i=i.l;else if(n>i.k)if(i.r===null){i.r=new E(n,[r]),o.push({parent:i,node:i.r});break}else c=i,i=i.r;else return i.v.add(r),e;let a=!1;this.insertCount++%s===0&&(a=!0);for(let l=o.length-1;l>=0;l--){const{parent:f,node:u}=o[l];if(u.updateHeight(),a){const d=this.rebalanceNode(u);f?f.l===u?f.l=d:f.r===u&&(f.r=d):e=d}}return e}rebalanceNode(e){const n=e.getBalanceFactor();if(n>1){if(e.l&&e.l.getBalanceFactor()>=0)return e.rotateRight();if(e.l)return e.l=e.l.rotateLeft(),e.rotateRight()}if(n<-1){if(e.r&&e.r.getBalanceFactor()<=0)return e.rotateLeft();if(e.r)return e.r=e.r.rotateRight(),e.rotateLeft()}return e}find(e){const n=this.findNodeByKey(e);return n?n.v:null}contains(e){return this.find(e)!==null}getSize(){let e=0;const n=[];let r=this.root;for(;r||n.length>0;){for(;r;)n.push(r),r=r.l;r=n.pop(),e++,r=r.r}return e}isBalanced(){if(!this.root)return!0;const e=[this.root];for(;e.length>0;){const n=e.pop(),r=n.getBalanceFactor();if(Math.abs(r)>1)return!1;n.l&&e.push(n.l),n.r&&e.push(n.r)}return!0}remove(e){this.root=this.removeNode(this.root,e)}removeDocument(e,n){const r=this.findNodeByKey(e);r&&(r.v.size===1?this.root=this.removeNode(this.root,e):r.v=new Set([...r.v.values()].filter(s=>s!==n)))}findNodeByKey(e){let n=this.root;for(;n;)if(e<n.k)n=n.l;else if(e>n.k)n=n.r;else return n;return null}removeNode(e,n){if(e===null)return null;const r=[];let s=e;for(;s!==null&&s.k!==n;)r.push(s),n<s.k?s=s.l:s=s.r;if(s===null)return e;if(s.l===null||s.r===null){const o=s.l?s.l:s.r;if(r.length===0)e=o;else{const i=r[r.length-1];i.l===s?i.l=o:i.r=o}}else{let o=s,i=s.r;for(;i.l!==null;)o=i,i=i.l;s.k=i.k,s.v=i.v,o.l===i?o.l=i.r:o.r=i.r,s=o}r.push(s);for(let o=r.length-1;o>=0;o--){const i=r[o];i.updateHeight();const c=this.rebalanceNode(i);if(o>0){const a=r[o-1];a.l===i?a.l=c:a.r===i&&(a.r=c)}else e=c}return e}rangeSearch(e,n){const r=new Set,s=[];let o=this.root;for(;o||s.length>0;){for(;o;)s.push(o),o=o.l;if(o=s.pop(),o.k>=e&&o.k<=n)for(const i of o.v)r.add(i);if(o.k>n)break;o=o.r}return r}greaterThan(e,n=!1){const r=new Set,s=[];let o=this.root;for(;o||s.length>0;){for(;o;)s.push(o),o=o.r;if(o=s.pop(),n&&o.k>=e||!n&&o.k>e)for(const i of o.v)r.add(i);else if(o.k<=e)break;o=o.l}return r}lessThan(e,n=!1){const r=new Set,s=[];let o=this.root;for(;o||s.length>0;){for(;o;)s.push(o),o=o.l;if(o=s.pop(),n&&o.k<=e||!n&&o.k<e)for(const i of o.v)r.add(i);else if(o.k>e)break;o=o.r}return r}}class X{numberToDocumentId;constructor(){this.numberToDocumentId=new Map}insert(e,n){this.numberToDocumentId.has(e)?this.numberToDocumentId.get(e).add(n):this.numberToDocumentId.set(e,new Set([n]))}find(e){const n=this.numberToDocumentId.get(e);return n?Array.from(n):null}remove(e){this.numberToDocumentId.delete(e)}removeDocument(e,n){const r=this.numberToDocumentId.get(n);r&&(r.delete(e),r.size===0&&this.numberToDocumentId.delete(n))}contains(e){return this.numberToDocumentId.has(e)}getSize(){let e=0;for(const n of this.numberToDocumentId.values())e+=n.size;return e}filter(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const r=n[0];switch(r){case"eq":{const s=e[r],o=this.numberToDocumentId.get(s);return o?Array.from(o):[]}case"in":{const s=e[r],o=new Set;for(const i of s){const c=this.numberToDocumentId.get(i);if(c)for(const a of c)o.add(a)}return Array.from(o)}case"nin":{const s=new Set(e[r]),o=new Set;for(const[i,c]of this.numberToDocumentId.entries())if(!s.has(i))for(const a of c)o.add(a);return Array.from(o)}default:throw new Error("Invalid operation")}}filterArr(e){const n=Object.keys(e);if(n.length!==1)throw new Error("Invalid operation");const r=n[0];switch(r){case"containsAll":{const o=e[r].map(c=>this.numberToDocumentId.get(c)??new Set);if(o.length===0)return[];const i=o.reduce((c,a)=>new Set([...c].filter(l=>a.has(l))));return Array.from(i)}case"containsAny":{const o=e[r].map(c=>this.numberToDocumentId.get(c)??new Set);if(o.length===0)return[];const i=o.reduce((c,a)=>new Set([...c,...a]));return Array.from(i)}default:throw new Error("Invalid operation")}}static fromJSON(e){if(!e.numberToDocumentId)throw new Error("Invalid Flat Tree JSON");const n=new X;for(const[r,s]of e.numberToDocumentId)n.numberToDocumentId.set(r,new Set(s));return n}toJSON(){return{numberToDocumentId:Array.from(this.numberToDocumentId.entries()).map(([e,n])=>[e,Array.from(n)])}}}function Vt(t,e,n){if(n<0)return-1;if(t===e)return 0;const r=t.length,s=e.length;if(r===0)return s<=n?s:-1;if(s===0)return r<=n?r:-1;const o=Math.abs(r-s);if(t.startsWith(e))return o<=n?o:-1;if(e.startsWith(t))return 0;if(o>n)return-1;const i=[];for(let c=0;c<=r;c++){i[c]=[c];for(let a=1;a<=s;a++)i[c][a]=c===0?a:0}for(let c=1;c<=r;c++){let a=1/0;for(let l=1;l<=s;l++)t[c-1]===e[l-1]?i[c][l]=i[c-1][l-1]:i[c][l]=Math.min(i[c-1][l]+1,i[c][l-1]+1,i[c-1][l-1]+1),a=Math.min(a,i[c][l]);if(a>n)return-1}return i[r][s]<=n?i[r][s]:-1}function Ae(t,e,n){const r=Vt(t,e,n);return{distance:r,isBounded:r>=0}}class k{k;s;c=new Map;d=new Set;e;w="";constructor(e,n,r){this.k=e,this.s=n,this.e=r}updateParent(e){this.w=e.w+this.s}addDocument(e){this.d.add(e)}removeDocument(e){return this.d.delete(e)}findAllWords(e,n,r,s){const o=[this];for(;o.length>0;){const i=o.pop();if(i.e){const{w:c,d:a}=i;if(r&&c!==n)continue;if(oe(e,c)!==null)if(s)if(Math.abs(n.length-c.length)<=s&&Ae(n,c,s).isBounded)e[c]=[];else continue;else e[c]=[];if(oe(e,c)!=null&&a.size>0){const l=e[c];for(const f of a)l.includes(f)||l.push(f)}}i.c.size>0&&o.push(...i.c.values())}return e}insert(e,n){let r=this,s=0;const o=e.length;for(;s<o;){const i=e[s],c=r.c.get(i);if(c){const a=c.s,l=a.length;let f=0;for(;f<l&&s+f<o&&a[f]===e[s+f];)f++;if(f===l){if(r=c,s+=f,s===o){c.e||(c.e=!0),c.addDocument(n);return}continue}const u=a.slice(0,f),d=a.slice(f),h=e.slice(s+f),p=new k(u[0],u,!1);if(r.c.set(u[0],p),p.updateParent(r),c.s=d,c.k=d[0],p.c.set(d[0],c),c.updateParent(p),h){const y=new k(h[0],h,!0);y.addDocument(n),p.c.set(h[0],y),y.updateParent(p)}else p.e=!0,p.addDocument(n);return}else{const a=new k(i,e.slice(s),!0);a.addDocument(n),r.c.set(i,a),a.updateParent(r);return}}r.e||(r.e=!0),r.addDocument(n)}_findLevenshtein(e,n,r,s,o){const i=[{node:this,index:n,tolerance:r}];for(;i.length>0;){const{node:c,index:a,tolerance:l}=i.pop();if(c.w.startsWith(e)){c.findAllWords(o,e,!1,0);continue}if(l<0)continue;if(c.e){const{w:u,d}=c;if(u&&(Ae(e,u,s).isBounded&&(o[u]=[]),oe(o,u)!==void 0&&d.size>0)){const h=new Set(o[u]);for(const p of d)h.add(p);o[u]=Array.from(h)}}if(a>=e.length)continue;const f=e[a];if(c.c.has(f)){const u=c.c.get(f);i.push({node:u,index:a+1,tolerance:l})}i.push({node:c,index:a+1,tolerance:l-1});for(const[u,d]of c.c)i.push({node:d,index:a,tolerance:l-1}),u!==f&&i.push({node:d,index:a+1,tolerance:l-1})}}find(e){const{term:n,exact:r,tolerance:s}=e;if(s&&!r){const o={};return this._findLevenshtein(n,0,s,s,o),o}else{let o=this,i=0;const c=n.length;for(;i<c;){const l=n[i],f=o.c.get(l);if(f){const u=f.s,d=u.length;let h=0;for(;h<d&&i+h<c&&u[h]===n[i+h];)h++;if(h===d)o=f,i+=h;else if(i+h===c)if(h===c-i){if(r)return{};{const p={};return f.findAllWords(p,n,r,s),p}}else return{};else return{}}else return{}}const a={};return o.findAllWords(a,n,r,s),a}}contains(e){let n=this,r=0;const s=e.length;for(;r<s;){const o=e[r],i=n.c.get(o);if(i){const c=i.s,a=c.length;let l=0;for(;l<a&&r+l<s&&c[l]===e[r+l];)l++;if(l<a)return!1;r+=a,n=i}else return!1}return!0}removeWord(e){if(!e)return!1;let n=this;const r=e.length,s=[];for(let o=0;o<r;o++){const i=e[o];if(n.c.has(i)){const c=n.c.get(i);s.push({parent:n,character:i}),o+=c.s.length-1,n=c}else return!1}for(n.d.clear(),n.e=!1;s.length>0&&n.c.size===0&&!n.e&&n.d.size===0;){const{parent:o,character:i}=s.pop();o.c.delete(i),n=o}return!0}removeDocumentByWord(e,n,r=!0){if(!e)return!0;let s=this;const o=e.length;for(let i=0;i<o;i++){const c=e[i];if(s.c.has(c)){const a=s.c.get(c);i+=a.s.length-1,s=a,r&&s.w!==e||s.removeDocument(n)}else return!1}return!0}static getCommonPrefix(e,n){const r=Math.min(e.length,n.length);let s=0;for(;s<r&&e.charCodeAt(s)===n.charCodeAt(s);)s++;return e.slice(0,s)}toJSON(){return{w:this.w,s:this.s,e:this.e,k:this.k,d:Array.from(this.d),c:Array.from(this.c?.entries())?.map(([e,n])=>[e,n.toJSON()])}}static fromJSON(e){const n=new k(e.k,e.s,e.e);return n.w=e.w,n.d=new Set(e.d),n.c=new Map(e?.c?.map(([r,s])=>[r,k.fromJSON(s)])||[]),n}}class Z extends k{constructor(){super("","",!1)}static fromJSON(e){const n=new Z;return n.w=e.w,n.s=e.s,n.e=e.e,n.k=e.k,n.d=new Set(e.d),n.c=new Map(e?.c?.map(([r,s])=>[r,k.fromJSON(s)])||[]),n}toJSON(){return super.toJSON()}}const Wt=2,$t=6371e3;class C{point;docIDs;left;right;parent;constructor(e,n){this.point=e,this.docIDs=new Set(n),this.left=null,this.right=null,this.parent=null}toJSON(){return{point:this.point,docIDs:Array.from(this.docIDs),left:this.left?this.left.toJSON():null,right:this.right?this.right.toJSON():null}}static fromJSON(e,n=null){const r=new C(e.point,e.docIDs);return r.parent=n,e.left&&(r.left=C.fromJSON(e.left,r)),e.right&&(r.right=C.fromJSON(e.right,r)),r}}class v{root;nodeMap;constructor(){this.root=null,this.nodeMap=new Map}getPointKey(e){return`${e.lon},${e.lat}`}insert(e,n){const r=this.getPointKey(e),s=this.nodeMap.get(r);if(s){n.forEach(a=>s.docIDs.add(a));return}const o=new C(e,n);if(this.nodeMap.set(r,o),this.root==null){this.root=o;return}let i=this.root,c=0;for(;;){if(c%Wt===0)if(e.lon<i.point.lon){if(i.left==null){i.left=o,o.parent=i;return}i=i.left}else{if(i.right==null){i.right=o,o.parent=i;return}i=i.right}else if(e.lat<i.point.lat){if(i.left==null){i.left=o,o.parent=i;return}i=i.left}else{if(i.right==null){i.right=o,o.parent=i;return}i=i.right}c++}}contains(e){const n=this.getPointKey(e);return this.nodeMap.has(n)}getDocIDsByCoordinates(e){const n=this.getPointKey(e),r=this.nodeMap.get(n);return r?Array.from(r.docIDs):null}removeDocByID(e,n){const r=this.getPointKey(e),s=this.nodeMap.get(r);s&&(s.docIDs.delete(n),s.docIDs.size===0&&(this.nodeMap.delete(r),this.deleteNode(s)))}deleteNode(e){const n=e.parent,r=e.left?e.left:e.right;r&&(r.parent=n),n?n.left===e?n.left=r:n.right===e&&(n.right=r):(this.root=r,this.root&&(this.root.parent=null))}searchByRadius(e,n,r=!0,s="asc",o=!1){const i=o?v.vincentyDistance:v.haversineDistance,c=[{node:this.root,depth:0}],a=[];for(;c.length>0;){const{node:l,depth:f}=c.pop();if(l==null)continue;const u=i(e,l.point);(r?u<=n:u>n)&&a.push({point:l.point,docIDs:Array.from(l.docIDs)}),l.left!=null&&c.push({node:l.left,depth:f+1}),l.right!=null&&c.push({node:l.right,depth:f+1})}return s&&a.sort((l,f)=>{const u=i(e,l.point),d=i(e,f.point);return s.toLowerCase()==="asc"?u-d:d-u}),a}searchByPolygon(e,n=!0,r=null,s=!1){const o=[{node:this.root,depth:0}],i=[];for(;o.length>0;){const{node:a,depth:l}=o.pop();if(a==null)continue;a.left!=null&&o.push({node:a.left,depth:l+1}),a.right!=null&&o.push({node:a.right,depth:l+1});const f=v.isPointInPolygon(e,a.point);(f&&n||!f&&!n)&&i.push({point:a.point,docIDs:Array.from(a.docIDs)})}const c=v.calculatePolygonCentroid(e);if(r){const a=s?v.vincentyDistance:v.haversineDistance;i.sort((l,f)=>{const u=a(c,l.point),d=a(c,f.point);return r.toLowerCase()==="asc"?u-d:d-u})}return i}toJSON(){return{root:this.root?this.root.toJSON():null}}static fromJSON(e){const n=new v;return e.root&&(n.root=C.fromJSON(e.root),n.buildNodeMap(n.root)),n}buildNodeMap(e){if(e==null)return;const n=this.getPointKey(e.point);this.nodeMap.set(n,e),e.left&&this.buildNodeMap(e.left),e.right&&this.buildNodeMap(e.right)}static calculatePolygonCentroid(e){let n=0,r=0,s=0;const o=e.length;for(let c=0,a=o-1;c<o;a=c++){const l=e[c].lon,f=e[c].lat,u=e[a].lon,d=e[a].lat,h=l*d-u*f;n+=h,r+=(l+u)*h,s+=(f+d)*h}n/=2;const i=6*n;return r/=i,s/=i,{lon:r,lat:s}}static isPointInPolygon(e,n){let r=!1;const s=n.lon,o=n.lat,i=e.length;for(let c=0,a=i-1;c<i;a=c++){const l=e[c].lon,f=e[c].lat,u=e[a].lon,d=e[a].lat;f>o!=d>o&&s<(u-l)*(o-f)/(d-f)+l&&(r=!r)}return r}static haversineDistance(e,n){const r=Math.PI/180,s=e.lat*r,o=n.lat*r,i=(n.lat-e.lat)*r,c=(n.lon-e.lon)*r,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(s)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2),l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return $t*l}static vincentyDistance(e,n){const s=.0033528106647474805,o=(1-s)*6378137,i=Math.PI/180,c=e.lat*i,a=n.lat*i,l=(n.lon-e.lon)*i,f=Math.atan((1-s)*Math.tan(c)),u=Math.atan((1-s)*Math.tan(a)),d=Math.sin(f),h=Math.cos(f),p=Math.sin(u),y=Math.cos(u);let m=l,g,S=1e3,b,I,w,O,D,x;do{const L=Math.sin(m),z=Math.cos(m);if(b=Math.sqrt(y*L*(y*L)+(h*p-d*y*z)*(h*p-d*y*z)),b===0)return 0;I=d*p+h*y*z,w=Math.atan2(b,I),O=h*y*L/b,D=1-O*O,x=I-2*d*p/D,isNaN(x)&&(x=0);const ne=s/16*D*(4+s*(4-3*D));g=m,m=l+(1-ne)*s*O*(w+ne*b*(x+ne*I*(-1+2*x*x)))}while(Math.abs(m-g)>1e-12&&--S>0);if(S===0)return NaN;const A=D*(6378137*6378137-o*o)/(o*o),V=1+A/16384*(4096+A*(-768+A*(320-175*A))),M=A/1024*(256+A*(-128+A*(74-47*A))),te=M*b*(x+M/4*(I*(-1+2*x*x)-M/6*x*(-3+4*b*b)*(-3+4*x*x)));return o*V*(w-te)}}class Q{true;false;constructor(){this.true=new Set,this.false=new Set}insert(e,n){n?this.true.add(e):this.false.add(e)}delete(e,n){n?this.true.delete(e):this.false.delete(e)}getSize(){return this.true.size+this.false.size}toJSON(){return{true:Array.from(this.true),false:Array.from(this.false)}}static fromJSON(e){const n=new Q;return n.true=new Set(e.true),n.false=new Set(e.false),n}}function Gt(t,e,n,r,s,{k:o,b:i,d:c}){return Math.log(1+(n-e+.5)/(e+.5))*(c+t*(o+1))/(t+o*(1-i+i*r/s))}const Jt=.8;class ee{size;vectors=new Map;constructor(e){this.size=e}add(e,n){n instanceof Float32Array||(n=new Float32Array(n));const r=Xe(n,this.size);this.vectors.set(e,[r,n])}remove(e){this.vectors.delete(e)}find(e,n,r){return e instanceof Float32Array||(e=new Float32Array(e)),Yt(e,r,this.vectors,this.size,n)}toJSON(){const e=[];for(const[n,[r,s]]of this.vectors)e.push([n,[r,Array.from(s)]]);return{size:this.size,vectors:e}}static fromJSON(e){const n=e,r=new ee(n.size);for(const[s,[o,i]]of n.vectors)r.vectors.set(s,[o,new Float32Array(i)]);return r}}function Xe(t,e){let n=0;for(let r=0;r<e;r++)n+=t[r]*t[r];return Math.sqrt(n)}function Yt(t,e,n,r,s){const o=Xe(t,r),i=[],c=e||n.keys();for(const a of c){const l=n.get(a);if(!l)continue;const f=l[0],u=l[1];let d=0;for(let p=0;p<r;p++)d+=t[p]*u[p];const h=d/(o*f);h>=s&&i.push([a,h])}return i}function Ht(t,e,n,r,s){const o=_(t.sharedInternalDocumentStore,n);t.avgFieldLength[e]=((t.avgFieldLength[e]??0)*(s-1)+r.length)/s,t.fieldLengths[e][o]=r.length,t.frequencies[e][o]={}}function qt(t,e,n,r,s){let o=0;for(const a of r)a===s&&o++;const i=_(t.sharedInternalDocumentStore,n),c=o/r.length;t.frequencies[e][i][s]=c,s in t.tokenOccurrences[e]||(t.tokenOccurrences[e][s]=0),t.tokenOccurrences[e][s]=(t.tokenOccurrences[e][s]??0)+1}function Kt(t,e,n,r){const s=_(t.sharedInternalDocumentStore,n);r>1?t.avgFieldLength[e]=(t.avgFieldLength[e]*r-t.fieldLengths[e][s])/(r-1):t.avgFieldLength[e]=void 0,t.fieldLengths[e][s]=void 0,t.frequencies[e][s]=void 0}function Xt(t,e,n){t.tokenOccurrences[e][n]--}function Ze(t,e,n,r,s=""){r||(r={sharedInternalDocumentStore:e,indexes:{},vectorIndexes:{},searchableProperties:[],searchablePropertiesWithTypes:{},frequencies:{},tokenOccurrences:{},avgFieldLength:{},fieldLengths:{}});for(const[o,i]of Object.entries(n)){const c=`${s}${s?".":""}${o}`;if(typeof i=="object"&&!Array.isArray(i)){Ze(t,e,i,r,c);continue}if(B(i))r.searchableProperties.push(c),r.searchablePropertiesWithTypes[c]=i,r.vectorIndexes[c]={type:"Vector",node:new ee(Ke(i)),isArray:!1};else{const a=/\[/.test(i);switch(i){case"boolean":case"boolean[]":r.indexes[c]={type:"Bool",node:new Q,isArray:a};break;case"number":case"number[]":r.indexes[c]={type:"AVL",node:new K(0,[]),isArray:a};break;case"string":case"string[]":r.indexes[c]={type:"Radix",node:new Z,isArray:a},r.avgFieldLength[c]=0,r.frequencies[c]={},r.tokenOccurrences[c]={},r.fieldLengths[c]={};break;case"enum":case"enum[]":r.indexes[c]={type:"Flat",node:new X,isArray:a};break;case"geopoint":r.indexes[c]={type:"BKD",node:new v,isArray:a};break;default:throw T("INVALID_SCHEMA_TYPE",Array.isArray(i)?"array":i,c)}r.searchableProperties.push(c),r.searchablePropertiesWithTypes[c]=i}}return r}function Zt(t,e,n,r,s,o,i,c){return a=>{const{type:l,node:f}=e.indexes[n];switch(l){case"Bool":{f[a?"true":"false"].add(r);break}case"AVL":{const u=c?.avlRebalanceThreshold??1;f.insert(a,r,u);break}case"Radix":{const u=o.tokenize(a,s,n,!1);t.insertDocumentScoreParameters(e,n,r,u,i);for(const d of u)t.insertTokenScoreParameters(e,n,r,u,d),f.insert(d,r);break}case"Flat":{f.insert(a,r);break}case"BKD":{f.insert(a,[r]);break}}}}function Qt(t,e,n,r,s,o,i,c,a,l,f){if(B(i))return en(e,n,o,r,s);const u=Zt(t,e,n,s,c,a,l,f);if(!de(i))return u(o);const d=o,h=d.length;for(let p=0;p<h;p++)u(d[p])}function en(t,e,n,r,s){t.vectorIndexes[e].node.add(s,n)}function Ee(t,e,n,r,s,o,i,c,a,l){if(B(i))return e.vectorIndexes[n].node.remove(s),!0;const{type:f,node:u}=e.indexes[n];switch(f){case"AVL":return u.removeDocument(o,s),!0;case"Bool":return u[o?"true":"false"].delete(s),!0;case"Radix":{const d=a.tokenize(o,c,n);t.removeDocumentScoreParameters(e,n,r,l);for(const h of d)t.removeTokenScoreParameters(e,n,h),u.removeDocumentByWord(h,s);return!0}case"Flat":return u.removeDocument(s,o),!0;case"BKD":return u.removeDocByID(o,s),!1}}function tn(t,e,n,r,s,o,i,c,a,l){if(!de(i))return Ee(t,e,n,r,s,o,i,c,a,l);const f=qe(i),u=o,d=u.length;for(let h=0;h<d;h++)Ee(t,e,n,r,s,u[h],f,c,a,l);return!0}function Qe(t,e,n,r,s,o,i,c,a,l){const f=Array.from(r),u=t.avgFieldLength[e],d=t.fieldLengths[e],h=t.tokenOccurrences[e],p=t.frequencies[e],y=typeof h[n]=="number"?h[n]??0:0,m=f.length;for(let g=0;g<m;g++){const S=f[g];if(a&&!a.has(S))continue;l.has(S)||l.set(S,new Map);const b=l.get(S);b.set(e,(b.get(e)||0)+1);const I=p?.[S]?.[n]??0,w=Gt(I,y,s,d[S],u,o);i.has(S)?i.set(S,i.get(S)+w*c):i.set(S,w*c)}}function nn(t,e,n,r,s,o,i,c,a,l,f,u=0){const d=n.tokenize(e,r),h=d.length||1,p=new Map,y=new Map,m=new Map;for(const b of s){if(!(b in t.indexes))continue;const I=t.indexes[b],{type:w}=I;if(w!=="Radix")throw T("WRONG_SEARCH_PROPERTY_TYPE",b);const O=c[b]??1;if(O<=0)throw T("INVALID_BOOST_VALUE",O);d.length===0&&!e&&d.push("");const D=d.length;for(let x=0;x<D;x++){const A=d[x],V=I.node.find({term:A,exact:o,tolerance:i}),M=Object.keys(V);M.length>0&&y.set(A,!0);const te=M.length;for(let W=0;W<te;W++){const L=M[W],z=V[L];Qe(t,b,L,z,l,a,m,O,f,p)}}}const g=Array.from(m.entries()).map(([b,I])=>[b,I]).sort((b,I)=>I[1]-b[1]);if(g.length===0)return[];if(u===1)return g;if(u===0){if(h===1)return g;for(const I of d)if(!y.get(I))return[];return g.filter(([I])=>{const w=p.get(I);return w?Array.from(w.values()).some(O=>O===h):!1})}const S=g.filter(([b])=>{const I=p.get(b);return I?Array.from(I.values()).some(w=>w===h):!1});if(S.length>0){const b=g.filter(([w])=>!S.some(([O])=>O===w)),I=Math.ceil(b.length*u);return[...S,...b.slice(0,I)]}return g}function J(t,e,n,r){if("and"in n&&n.and&&Array.isArray(n.and)){const i=n.and;if(i.length===0)return new Set;const c=i.map(a=>J(t,e,a,r));return xe(...c)}if("or"in n&&n.or&&Array.isArray(n.or)){const i=n.or;return i.length===0?new Set:i.map(a=>J(t,e,a,r)).reduce((a,l)=>$(a,l),new Set)}if("not"in n&&n.not){const i=n.not,c=new Set,a=t.sharedInternalDocumentStore;for(let f=1;f<=a.internalIdToId.length;f++)c.add(f);const l=J(t,e,i,r);return St(c,l)}const s=Object.keys(n),o=s.reduce((i,c)=>({[c]:new Set,...i}),{});for(const i of s){const c=n[i];if(typeof t.indexes[i]>"u")throw T("UNKNOWN_FILTER_PROPERTY",i);const{node:a,type:l,isArray:f}=t.indexes[i];if(l==="Bool"){const d=a,h=c?d.true:d.false;o[i]=$(o[i],h);continue}if(l==="BKD"){let d;if("radius"in c)d="radius";else if("polygon"in c)d="polygon";else throw new Error(`Invalid operation ${c}`);if(d==="radius"){const{value:h,coordinates:p,unit:y="m",inside:m=!0,highPrecision:g=!1}=c[d],S=Je(h,y),b=a.searchByRadius(p,S,m,void 0,g);o[i]=ve(o[i],b)}else{const{coordinates:h,inside:p=!0,highPrecision:y=!1}=c[d],m=a.searchByPolygon(h,p,void 0,y);o[i]=ve(o[i],m)}continue}if(l==="Radix"&&(typeof c=="string"||Array.isArray(c))){for(const d of[c].flat()){const h=e.tokenize(d,r,i);for(const p of h){const y=a.find({term:p,exact:!0});o[i]=fn(o[i],y)}}continue}const u=Object.keys(c);if(u.length>1)throw T("INVALID_FILTER_OPERATION",u.length);if(l==="Flat"){const d=new Set(f?a.filterArr(c):a.filter(c));o[i]=$(o[i],d);continue}if(l==="AVL"){const d=u[0],h=c[d];let p;switch(d){case"gt":{p=a.greaterThan(h,!1);break}case"gte":{p=a.greaterThan(h,!0);break}case"lt":{p=a.lessThan(h,!1);break}case"lte":{p=a.lessThan(h,!0);break}case"eq":{p=a.find(h)??new Set;break}case"between":{const[y,m]=h;p=a.rangeSearch(y,m);break}default:throw T("INVALID_FILTER_OPERATION",d)}o[i]=$(o[i],p)}}return xe(...Object.values(o))}function rn(t){return t.searchableProperties}function sn(t){return t.searchablePropertiesWithTypes}function on(t,e){const{indexes:n,vectorIndexes:r,searchableProperties:s,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:c,avgFieldLength:a,fieldLengths:l}=e,f={},u={};for(const d of Object.keys(n)){const{node:h,type:p,isArray:y}=n[d];switch(p){case"Radix":f[d]={type:"Radix",node:Z.fromJSON(h),isArray:y};break;case"Flat":f[d]={type:"Flat",node:X.fromJSON(h),isArray:y};break;case"AVL":f[d]={type:"AVL",node:K.fromJSON(h),isArray:y};break;case"BKD":f[d]={type:"BKD",node:v.fromJSON(h),isArray:y};break;case"Bool":f[d]={type:"Bool",node:Q.fromJSON(h),isArray:y};break;default:f[d]=n[d]}}for(const d of Object.keys(r))u[d]={type:"Vector",isArray:!1,node:ee.fromJSON(r[d])};return{sharedInternalDocumentStore:t,indexes:f,vectorIndexes:u,searchableProperties:s,searchablePropertiesWithTypes:o,frequencies:i,tokenOccurrences:c,avgFieldLength:a,fieldLengths:l}}function cn(t){const{indexes:e,vectorIndexes:n,searchableProperties:r,searchablePropertiesWithTypes:s,frequencies:o,tokenOccurrences:i,avgFieldLength:c,fieldLengths:a}=t,l={};for(const u of Object.keys(n))l[u]=n[u].node.toJSON();const f={};for(const u of Object.keys(e)){const{type:d,node:h,isArray:p}=e[u];d==="Flat"||d==="Radix"||d==="AVL"||d==="BKD"||d==="Bool"?f[u]={type:d,node:h.toJSON(),isArray:p}:(f[u]=e[u],f[u].node=f[u].node.toJSON())}return{indexes:f,vectorIndexes:l,searchableProperties:r,searchablePropertiesWithTypes:s,frequencies:o,tokenOccurrences:i,avgFieldLength:c,fieldLengths:a}}function an(){return{create:Ze,insert:Qt,remove:tn,insertDocumentScoreParameters:Ht,insertTokenScoreParameters:qt,removeDocumentScoreParameters:Kt,removeTokenScoreParameters:Xt,calculateResultScores:Qe,search:nn,searchByWhereClause:J,getSearchableProperties:rn,getSearchablePropertiesWithTypes:sn,load:on,save:cn}}function ve(t,e){t||(t=new Set);const n=e.length;for(let r=0;r<n;r++){const s=e[r].docIDs,o=s.length;for(let i=0;i<o;i++)t.add(s[i])}return t}function _e(t,e,n=!1){const r=n?v.vincentyDistance:v.haversineDistance,s=[],o=[];for(const{point:a}of t)o.push(r(e,a));const i=Math.max(...o);let c=0;for(const{docIDs:a}of t){const l=o[c],f=i-l+1;for(const u of a)s.push([u,f]);c++}return s.sort((a,l)=>l[1]-a[1]),s}function ln(t,e){const n=Object.keys(t);if(n.length!==1)return{isGeoOnly:!1};const r=n[0],s=t[r];if(typeof e.indexes[r]>"u")return{isGeoOnly:!1};const{type:o}=e.indexes[r];return o==="BKD"&&s&&("radius"in s||"polygon"in s)?{isGeoOnly:!0,geoProperty:r,geoOperation:s}:{isGeoOnly:!1}}function un(t,e){const n=t,r=ln(e,n);if(!r.isGeoOnly||!r.geoProperty||!r.geoOperation)return null;const{node:s}=n.indexes[r.geoProperty],o=r.geoOperation,i=s;let c;if("radius"in o){const{value:a,coordinates:l,unit:f="m",inside:u=!0,highPrecision:d=!1}=o.radius,h=l,p=Je(a,f);return c=i.searchByRadius(h,p,u,"asc",d),_e(c,h,d)}else if("polygon"in o){const{coordinates:a,inside:l=!0,highPrecision:f=!1}=o.polygon;c=i.searchByPolygon(a,l,"asc",f);const u=v.calculatePolygonCentroid(a);return _e(c,u,f)}return null}function fn(t,e){t||(t=new Set);const n=Object.keys(e),r=n.length;for(let s=0;s<r;s++){const o=e[n[s]],i=o.length;for(let c=0;c<i;c++)t.add(o[c])}return t}function et(t,e,n,r,s){const o={language:t.tokenizer.language,sharedInternalDocumentStore:e,enabled:!0,isSorted:!0,sortableProperties:[],sortablePropertiesWithTypes:{},sorts:{}};for(const[i,c]of Object.entries(n)){const a=`${s}${s?".":""}${i}`;if(!r.includes(a)){if(typeof c=="object"&&!Array.isArray(c)){const l=et(t,e,c,r,a);Ve(o.sortableProperties,l.sortableProperties),o.sorts={...o.sorts,...l.sorts},o.sortablePropertiesWithTypes={...o.sortablePropertiesWithTypes,...l.sortablePropertiesWithTypes};continue}if(!B(c))switch(c){case"boolean":case"number":case"string":o.sortableProperties.push(a),o.sortablePropertiesWithTypes[a]=c,o.sorts[a]={docs:new Map,orderedDocsToRemove:new Map,orderedDocs:[],type:c};break;case"geopoint":case"enum":continue;case"enum[]":case"boolean[]":case"number[]":case"string[]":continue;default:throw T("INVALID_SORT_SCHEMA_TYPE",Array.isArray(c)?"array":c,a)}}}return o}function dn(t,e,n,r){return r?.enabled!==!1?et(t,e,n,(r||{}).unsortableProperties||[],""):{disabled:!0}}function hn(t,e,n,r){if(!t.enabled)return;t.isSorted=!1;const s=_(t.sharedInternalDocumentStore,n),o=t.sorts[e];o.orderedDocsToRemove.has(s)&&ge(t,e),o.docs.set(s,o.orderedDocs.length),o.orderedDocs.push([s,r])}function tt(t){if(t.isSorted||!t.enabled)return;const e=Object.keys(t.sorts);for(const n of e)yn(t,n);t.isSorted=!0}function pn(t,e,n){return e[1].localeCompare(n[1],lt(t))}function gn(t,e){return t[1]-e[1]}function mn(t,e){return e[1]?-1:1}function yn(t,e){const n=t.sorts[e];let r;switch(n.type){case"string":r=pn.bind(null,t.language);break;case"number":r=gn.bind(null);break;case"boolean":r=mn.bind(null);break}n.orderedDocs.sort(r);const s=n.orderedDocs.length;for(let o=0;o<s;o++){const i=n.orderedDocs[o][0];n.docs.set(i,o)}}function Sn(t){const e=Object.keys(t.sorts);for(const n of e)ge(t,n)}function ge(t,e){const n=t.sorts[e];n.orderedDocsToRemove.size&&(n.orderedDocs=n.orderedDocs.filter(r=>!n.orderedDocsToRemove.has(r[0])),n.orderedDocsToRemove.clear())}function bn(t,e,n){if(!t.enabled)return;const r=t.sorts[e],s=_(t.sharedInternalDocumentStore,n);r.docs.get(s)&&(r.docs.delete(s),r.orderedDocsToRemove.set(s,!0))}function In(t,e,n){if(!t.enabled)throw T("SORT_DISABLED");const r=n.property,s=n.order==="DESC",o=t.sorts[r];if(!o)throw T("UNABLE_TO_SORT_ON_UNKNOWN_FIELD",r,t.sortableProperties.join(", "));return ge(t,r),tt(t),e.sort((i,c)=>{const a=o.docs.get(_(t.sharedInternalDocumentStore,i[0])),l=o.docs.get(_(t.sharedInternalDocumentStore,c[0])),f=typeof a<"u",u=typeof l<"u";return!f&&!u?0:f?u?s?l-a:a-l:-1:1}),e}function Nn(t){return t.enabled?t.sortableProperties:[]}function wn(t){return t.enabled?t.sortablePropertiesWithTypes:{}}function Tn(t,e){const n=e;if(!n.enabled)return{enabled:!1};const r=Object.keys(n.sorts).reduce((s,o)=>{const{docs:i,orderedDocs:c,type:a}=n.sorts[o];return s[o]={docs:new Map(Object.entries(i).map(([l,f])=>[+l,f])),orderedDocsToRemove:new Map,orderedDocs:c,type:a},s},{});return{sharedInternalDocumentStore:t,language:n.language,sortableProperties:n.sortableProperties,sortablePropertiesWithTypes:n.sortablePropertiesWithTypes,sorts:r,enabled:!0,isSorted:n.isSorted}}function On(t){if(!t.enabled)return{enabled:!1};Sn(t),tt(t);const e=Object.keys(t.sorts).reduce((n,r)=>{const{docs:s,orderedDocs:o,type:i}=t.sorts[r];return n[r]={docs:Object.fromEntries(s.entries()),orderedDocs:o,type:i},n},{});return{language:t.language,sortableProperties:t.sortableProperties,sortablePropertiesWithTypes:t.sortablePropertiesWithTypes,sorts:e,enabled:t.enabled,isSorted:t.isSorted}}function xn(){return{create:dn,insert:hn,remove:bn,save:On,load:Tn,sortBy:In,getSortableProperties:Nn,getSortablePropertiesWithTypes:wn}}const Pe=192,Dn=383,An=[65,65,65,65,65,65,65,67,69,69,69,69,73,73,73,73,69,78,79,79,79,79,79,null,79,85,85,85,85,89,80,115,97,97,97,97,97,97,97,99,101,101,101,101,105,105,105,105,101,110,111,111,111,111,111,null,111,117,117,117,117,121,112,121,65,97,65,97,65,97,67,99,67,99,67,99,67,99,68,100,68,100,69,101,69,101,69,101,69,101,69,101,71,103,71,103,71,103,71,103,72,104,72,104,73,105,73,105,73,105,73,105,73,105,73,105,74,106,75,107,107,76,108,76,108,76,108,76,108,76,108,78,110,78,110,78,110,110,78,110,79,111,79,111,79,111,79,111,82,114,82,114,82,114,83,115,83,115,83,115,83,115,84,116,84,116,84,116,85,117,85,117,85,117,85,117,85,117,85,117,87,119,89,121,89,90,122,90,122,90,122,115];function En(t){return t<Pe||t>Dn?t:An[t-Pe]||t}function vn(t){const e=[];for(let n=0;n<t.length;n++)e[n]=En(t.charCodeAt(n));return String.fromCharCode(...e)}const _n={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},Pn={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},Rn="[^aeiou]",Y="[aeiouy]",R=Rn+"[^aeiouy]*",j=Y+"[aeiou]*",ie="^("+R+")?"+j+R,kn="^("+R+")?"+j+R+"("+j+")?$",G="^("+R+")?"+j+R+j+R,Re="^("+R+")?"+Y;function Mn(t){let e,n,r,s,o,i;if(t.length<3)return t;const c=t.substring(0,1);if(c=="y"&&(t=c.toUpperCase()+t.substring(1)),r=/^(.+?)(ss|i)es$/,s=/^(.+?)([^s])s$/,r.test(t)?t=t.replace(r,"$1$2"):s.test(t)&&(t=t.replace(s,"$1$2")),r=/^(.+?)eed$/,s=/^(.+?)(ed|ing)$/,r.test(t)){const a=r.exec(t);r=new RegExp(ie),r.test(a[1])&&(r=/.$/,t=t.replace(r,""))}else s.test(t)&&(e=s.exec(t)[1],s=new RegExp(Re),s.test(e)&&(t=e,s=/(at|bl|iz)$/,o=new RegExp("([^aeiouylsz])\\1$"),i=new RegExp("^"+R+Y+"[^aeiouwxy]$"),s.test(t)?t=t+"e":o.test(t)?(r=/.$/,t=t.replace(r,"")):i.test(t)&&(t=t+"e")));if(r=/^(.+?)y$/,r.test(t)&&(e=r.exec(t)?.[1],r=new RegExp(Re),e&&r.test(e)&&(t=e+"i")),r=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,r.test(t)){const a=r.exec(t);e=a?.[1],n=a?.[2],r=new RegExp(ie),e&&r.test(e)&&(t=e+_n[n])}if(r=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,r.test(t)){const a=r.exec(t);e=a?.[1],n=a?.[2],r=new RegExp(ie),e&&r.test(e)&&(t=e+Pn[n])}if(r=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,s=/^(.+?)(s|t)(ion)$/,r.test(t))e=r.exec(t)?.[1],r=new RegExp(G),e&&r.test(e)&&(t=e);else if(s.test(t)){const a=s.exec(t);e=a?.[1]??""+a?.[2]??"",s=new RegExp(G),s.test(e)&&(t=e)}return r=/^(.+?)e$/,r.test(t)&&(e=r.exec(t)?.[1],r=new RegExp(G),s=new RegExp(kn),o=new RegExp("^"+R+Y+"[^aeiouwxy]$"),e&&(r.test(e)||s.test(e)&&!o.test(e))&&(t=e)),r=/ll$/,s=new RegExp(G),r.test(t)&&s.test(t)&&(r=/.$/,t=t.replace(r,"")),c=="y"&&(t=c.toLowerCase()+t.substring(1)),t}function ke(t,e,n=!0){const r=`${this.language}:${t}:${e}`;return n&&this.normalizationCache.has(r)?this.normalizationCache.get(r):this.stopWords?.includes(e)?(n&&this.normalizationCache.set(r,""),""):(this.stemmer&&!this.stemmerSkipProperties.has(t)&&(e=this.stemmer(e)),e=vn(e),n&&this.normalizationCache.set(r,e),e)}function Ln(t){for(;t[t.length-1]==="";)t.pop();for(;t[0]==="";)t.shift();return t}function Me(t,e,n,r=!0){if(e&&e!==this.language)throw T("LANGUAGE_NOT_SUPPORTED",e);if(typeof t!="string")return[t];const s=this.normalizeToken.bind(this,n??"");let o;if(n&&this.tokenizeSkipProperties.has(n))o=[s(t,r)];else{const c=at[this.language];o=t.toLowerCase().split(c).map(a=>s(a,r)).filter(Boolean)}const i=Ln(o);return this.allowDuplicates?i:Array.from(new Set(i))}function Le(t={}){if(!t.language)t.language="english";else if(!le.includes(t.language))throw T("LANGUAGE_NOT_SUPPORTED",t.language);let e;if(t.stemming||t.stemmer&&!("stemming"in t))if(t.stemmer){if(typeof t.stemmer!="function")throw T("INVALID_STEMMER_FUNCTION_TYPE");e=t.stemmer}else if(t.language==="english")e=Mn;else throw T("MISSING_STEMMER",t.language);let n;if(t.stopWords!==!1){if(n=[],Array.isArray(t.stopWords))n=t.stopWords;else if(typeof t.stopWords=="function")n=t.stopWords(n);else if(t.stopWords)throw T("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");if(!Array.isArray(n))throw T("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY");for(const s of n)if(typeof s!="string")throw T("CUSTOM_STOP_WORDS_MUST_BE_FUNCTION_OR_ARRAY")}const r={tokenize:Me,language:t.language,stemmer:e,stemmerSkipProperties:new Set(t.stemmerSkipProperties?[t.stemmerSkipProperties].flat():[]),tokenizeSkipProperties:new Set(t.tokenizeSkipProperties?[t.tokenizeSkipProperties].flat():[]),stopWords:n,allowDuplicates:!!t.allowDuplicates,normalizeToken:ke,normalizationCache:new Map};return r.tokenize=Me.bind(r),r.normalizeToken=ke,r}function Cn(t){const e={formatElapsedTime:Nt,getDocumentIndexId:wt,getDocumentProperties:Ge,validateSchema:He};for(const n of De){const r=n;if(t[r]){if(typeof t[r]!="function")throw T("COMPONENT_MUST_BE_FUNCTION",r)}else t[r]=e[r]}for(const n of Object.keys(t))if(!jt.includes(n)&&!De.includes(n))throw T("UNSUPPORTED_COMPONENT",n)}function Un({schema:t,sort:e,language:n,components:r,id:s,plugins:o}){r||(r={});for(const g of o??[]){if(!("getComponents"in g)||typeof g.getComponents!="function")continue;const S=g.getComponents(t),b=Object.keys(S);for(const I of b)if(r[I])throw T("PLUGIN_COMPONENT_CONFLICT",I,g.name);r={...r,...S}}s||(s=We());let i=r.tokenizer,c=r.index,a=r.documentsStore,l=r.sorter;if(i?i.tokenize?i=i:i=Le(i):i=Le({language:n??"english"}),r.tokenizer&&n)throw T("NO_LANGUAGE_WITH_CUSTOM_TOKENIZER");const f=xt();c||=an(),l||=xn(),a||=Ut(),Cn(r);const{getDocumentProperties:u,getDocumentIndexId:d,validateSchema:h,formatElapsedTime:p}=r,y={data:{},caches:{},schema:t,tokenizer:i,index:c,sorter:l,documentsStore:a,internalDocumentIDStore:f,getDocumentProperties:u,getDocumentIndexId:d,validateSchema:h,beforeInsert:[],afterInsert:[],beforeRemove:[],afterRemove:[],beforeUpdate:[],afterUpdate:[],beforeUpsert:[],afterUpsert:[],beforeSearch:[],afterSearch:[],beforeInsertMultiple:[],afterInsertMultiple:[],beforeRemoveMultiple:[],afterRemoveMultiple:[],beforeUpdateMultiple:[],afterUpdateMultiple:[],beforeUpsertMultiple:[],afterUpsertMultiple:[],afterCreate:[],formatElapsedTime:p,id:s,plugins:o,version:zn()};y.data={index:y.index.create(y,f,t),docs:y.documentsStore.create(y,f),sorting:y.sorter.create(y,f,t,e)};for(const g of zt)y[g]=(y[g]??[]).concat(Ft(y,g));const m=y.afterCreate;return m&&Bt(m,y),y}function zn(){return"{{VERSION}}"}function Fn(t){return t.documentsStore.count(t.data.docs)}const Ce="fulltext",jn="hybrid",Bn="vector";function Vn(t,e){return t[1]-e[1]}function Wn(t,e){return e[1]-t[1]}function $n(t="desc"){return t.toLowerCase()==="asc"?Vn:Wn}function me(t,e,n){const r={},s=e.map(([l])=>l),o=t.documentsStore.getMultiple(t.data.docs,s),i=Object.keys(n),c=t.index.getSearchablePropertiesWithTypes(t.data.index);for(const l of i){let f;if(c[l]==="number"){const{ranges:u}=n[l],d=u.length,h=Array.from({length:d});for(let p=0;p<d;p++){const y=u[p];h[p]=[`${y.from}-${y.to}`,0]}f=Object.fromEntries(h)}r[l]={count:0,values:f??{}}}const a=o.length;for(let l=0;l<a;l++){const f=o[l];for(const u of i){const d=u.includes(".")?fe(f,u):f[u],h=c[u],p=r[u].values;switch(h){case"number":{const y=n[u].ranges;Ue(y,p)(d);break}case"number[]":{const y=new Set,m=n[u].ranges,g=Ue(m,p,y);for(const S of d)g(S);break}case"boolean":case"enum":case"string":{ze(p,h)(d);break}case"boolean[]":case"enum[]":case"string[]":{const g=ze(p,h==="boolean[]"?"boolean":"string",new Set);for(const S of d)g(S);break}default:throw T("FACET_NOT_SUPPORTED",h)}}}for(const l of i){const f=r[l];if(f.count=Object.keys(f.values).length,c[l]==="string"){const u=n[l],d=$n(u.sort);f.values=Object.fromEntries(Object.entries(f.values).sort(d).slice(u.offset??0,u.limit??10))}}return r}function Ue(t,e,n){return r=>{for(const s of t){const o=`${s.from}-${s.to}`;n?.has(o)||r>=s.from&&r<=s.to&&(e[o]===void 0?e[o]=1:(e[o]++,n?.add(o)))}}}function ze(t,e,n){const r=e==="boolean"?"false":"";return s=>{const o=s?.toString()??r;n?.has(o)||(t[o]=(t[o]??0)+1,n?.add(o))}}const Gn={reducer:(t,e,n,r)=>(e[r]=n,e),getInitialValue:t=>Array.from({length:t})},Fe=["string","number","boolean"];function ye(t,e,n){const r=n.properties,s=r.length,o=t.index.getSearchablePropertiesWithTypes(t.data.index);for(let g=0;g<s;g++){const S=r[g];if(typeof o[S]>"u")throw T("UNKNOWN_GROUP_BY_PROPERTY",S);if(!Fe.includes(o[S]))throw T("INVALID_GROUP_BY_PROPERTY",S,Fe.join(", "),o[S])}const i=e.map(([g])=>q(t.internalDocumentIDStore,g)),c=t.documentsStore.getMultiple(t.data.docs,i),a=c.length,l=n.maxResult||Number.MAX_SAFE_INTEGER,f=[],u={};for(let g=0;g<s;g++){const S=r[g],b={property:S,perValue:{}},I=new Set;for(let w=0;w<a;w++){const O=c[w],D=fe(O,S);if(typeof D>"u")continue;const x=typeof D!="boolean"?D:""+D,A=b.perValue[x]??{indexes:[],count:0};A.count>=l||(A.indexes.push(w),A.count++,b.perValue[x]=A,I.add(D))}f.push(Array.from(I)),u[S]=b}const d=nt(f),h=d.length,p=[];for(let g=0;g<h;g++){const S=d[g],b=S.length,I={values:[],indexes:[]},w=[];for(let O=0;O<b;O++){const D=S[O],x=r[O];w.push(u[x].perValue[typeof D!="boolean"?D:""+D].indexes),I.values.push(D)}I.indexes=gt(w).sort((O,D)=>O-D),I.indexes.length!==0&&p.push(I)}const y=p.length,m=Array.from({length:y});for(let g=0;g<y;g++){const S=p[g],b=n.reduce||Gn,I=S.indexes.map(x=>({id:i[x],score:e[x][1],document:c[x]})),w=b.reducer.bind(null,S.values),O=b.getInitialValue(S.indexes.length),D=I.reduce(w,O);m[g]={values:S.values,result:D}}return m}function nt(t,e=0){if(e+1===t.length)return t[e].map(o=>[o]);const n=t[e],r=nt(t,e+1),s=[];for(const o of n)for(const i of r){const c=[o];Ve(c,i),s.push(c)}return s}function rt(t,e,n){const{term:r,properties:s}=e,o=t.data.index;let i=t.caches.propertiesToSearch;if(!i){const u=t.index.getSearchablePropertiesWithTypes(o);i=t.index.getSearchableProperties(o),i=i.filter(d=>u[d].startsWith("string")),t.caches.propertiesToSearch=i}if(s&&s!=="*"){for(const u of s)if(!i.includes(u))throw T("UNKNOWN_INDEX",u,i.join(", "));i=i.filter(u=>s.includes(u))}const c=Object.keys(e.where??{}).length>0;let a;c&&(a=t.index.searchByWhereClause(o,t.tokenizer,e.where,n));let l;const f=e.threshold!==void 0&&e.threshold!==null?e.threshold:1;if(r||s){const u=Fn(t);l=t.index.search(o,r||"",t.tokenizer,n,i,e.exact||!1,e.tolerance||0,e.boost||{},Yn(e.relevance),u,a,f)}else if(c){const u=un(o,e.where);u?l=u:l=(a?Array.from(a):[]).map(h=>[+h,0])}else l=Object.keys(t.documentsStore.getAll(t.data.docs)).map(d=>[+d,0]);return l}function Jn(t,e,n){const r=U();function s(){const c=Object.keys(t.data.index.vectorIndexes),a=e.facets&&Object.keys(e.facets).length>0,{limit:l=10,offset:f=0,distinctOn:u,includeVectors:d=!1}=e,h=e.preflight===!0;let p=rt(t,e,n);if(e.sortBy)if(typeof e.sortBy=="function"){const g=p.map(([I])=>I),b=t.documentsStore.getMultiple(t.data.docs,g).map((I,w)=>[p[w][0],p[w][1],I]);b.sort(e.sortBy),p=b.map(([I,w])=>[I,w])}else p=t.sorter.sortBy(t.data.sorting,p,e.sortBy).map(([g,S])=>[_(t.internalDocumentIDStore,g),S]);else p=p.sort($e);let y;h||(y=u?nr(t,p,f,l,u):ot(t,p,f,l));const m={elapsed:{formatted:"",raw:0},hits:[],count:p.length};if(typeof y<"u"&&(m.hits=y.filter(Boolean),d||Ye(m,c)),a){const g=me(t,p,e.facets);m.facets=g}return e.groupBy&&(m.groups=ye(t,p,e.groupBy)),m.elapsed=t.formatElapsedTime(U()-r),m}async function o(){t.beforeSearch&&await pe(t.beforeSearch,t,e,n);const c=s();return t.afterSearch&&await he(t.afterSearch,t,e,n,c),c}return t.beforeSearch?.length||t.afterSearch?.length?o():s()}const ce={k:1.2,b:.75,d:.5};function Yn(t){const e=t??{};return e.k=e.k??ce.k,e.b=e.b??ce.b,e.d=e.d??ce.d,e}function st(t,e,n){const r=e.vector;if(r&&(!("value"in r)||!("property"in r)))throw T("INVALID_VECTOR_INPUT",Object.keys(r).join(", "));const s=t.data.index.vectorIndexes[r.property];if(!s)throw T("UNKNOWN_VECTOR_PROPERTY",r.property);const o=s.node.size;if(r?.value.length!==o)throw r?.property===void 0||r?.value.length===void 0?T("INVALID_INPUT_VECTOR","undefined",o,"undefined"):T("INVALID_INPUT_VECTOR",r.property,o,r.value.length);const i=t.data.index;let c;return Object.keys(e.where??{}).length>0&&(c=t.index.searchByWhereClause(i,t.tokenizer,e.where,n)),s.node.find(r.value,e.similarity??Jt,c)}function Hn(t,e,n="english"){const r=U();function s(){const c=st(t,e,n).sort($e);let a=[];e.facets&&Object.keys(e.facets).length>0&&(a=me(t,c,e.facets));const f=e.vector.property,u=e.includeVectors??!1,d=e.limit??10,h=e.offset??0,p=Array.from({length:d});for(let S=0;S<d;S++){const b=c[S+h];if(!b)break;const I=t.data.docs.docs[b[0]];if(I){u||(I[f]=null);const w={id:q(t.internalDocumentIDStore,b[0]),score:b[1],document:I};p[S]=w}}let y=[];e.groupBy&&(y=ye(t,c,e.groupBy));const g=U()-r;return{count:c.length,hits:p.filter(Boolean),elapsed:{raw:Number(g),formatted:ue(g)},...a?{facets:a}:{},...y?{groups:y}:{}}}async function o(){t.beforeSearch&&await pe(t.beforeSearch,t,e,n);const c=s();return t.afterSearch&&await he(t.afterSearch,t,e,n,c),c}return t.beforeSearch?.length||t.afterSearch?.length?o():s()}function qn(t,e,n){const r=Xn(rt(t,e,n)),s=st(t,e,n),o=e.hybridWeights;return Qn(r,s,e.term??"",o)}function Kn(t,e,n){const r=U();function s(){const c=qn(t,e,n);let a;e.facets&&Object.keys(e.facets).length>0&&(a=me(t,c,e.facets));let f;e.groupBy&&(f=ye(t,c,e.groupBy));const u=e.offset??0,d=e.limit??10,h=ot(t,c,u,d).filter(Boolean),p=U(),y={count:c.length,elapsed:{raw:Number(p-r),formatted:ue(p-r)},hits:h,...a?{facets:a}:{},...f?{groups:f}:{}};if(!(e.includeVectors??!1)){const g=Object.keys(t.data.index.vectorIndexes);Ye(y,g)}return y}async function o(){t.beforeSearch&&await pe(t.beforeSearch,t,e,n);const c=s();return t.afterSearch&&await he(t.afterSearch,t,e,n,c),c}return t.beforeSearch?.length||t.afterSearch?.length?o():s()}function ae(t){return t[1]}function Xn(t){const e=Math.max.apply(Math,t.map(ae));return t.map(([n,r])=>[n,r/e])}function je(t,e){return t/e}function Zn(t,e){return(n,r)=>n*t+r*e}function Qn(t,e,n,r){const s=Math.max.apply(Math,t.map(ae)),o=Math.max.apply(Math,e.map(ae)),i=r&&r.text&&r.vector,{text:c,vector:a}=i?r:er(),l=new Map,f=t.length,u=Zn(c,a);for(let h=0;h<f;h++){const[p,y]=t[h],m=je(y,s),g=u(m,0);l.set(p,g)}const d=e.length;for(let h=0;h<d;h++){const[p,y]=e[h],m=je(y,o),g=l.get(p)??0;l.set(p,g+u(0,m))}return[...l].sort((h,p)=>p[1]-h[1])}function er(t){return{text:.5,vector:.5}}function tr(t,e,n){const r=e.mode??Ce;if(r===Ce)return Jn(t,e,n);if(r===Bn)return Hn(t,e);if(r===jn)return Kn(t,e);throw T("INVALID_SEARCH_MODE",r)}function nr(t,e,n,r,s){const o=t.data.docs,i=new Map,c=[],a=new Set,l=e.length;let f=0;for(let u=0;u<l;u++){const d=e[u];if(typeof d>"u")continue;const[h,p]=d;if(a.has(h))continue;const y=t.documentsStore.get(o,h),m=fe(y,s);if(!(typeof m>"u"||i.has(m))&&(i.set(m,!0),f++,!(f<=n)&&(c.push({id:q(t.internalDocumentIDStore,h),score:p,document:y}),a.add(h),f>=n+r)))break}return c}function ot(t,e,n,r){const s=t.data.docs,o=Array.from({length:r}),i=new Set;for(let c=n;c<r+n;c++){const a=e[c];if(typeof a>"u")break;const[l,f]=a;if(!i.has(l)){const u=t.documentsStore.get(s,l);o[c]={id:q(t.internalDocumentIDStore,l),score:f,document:u},i.add(l)}}return o}function rr(t,e){t.internalDocumentIDStore.load(t,e.internalDocumentIDStore),t.data.index=t.index.load(t.internalDocumentIDStore,e.index),t.data.docs=t.documentsStore.load(t.internalDocumentIDStore,e.docs),t.data.sorting=t.sorter.load(t.internalDocumentIDStore,e.sorting),t.tokenizer.language=e.language}const sr={id:"string",type:"string",title:"string",description:"string",route:"string",badges:"string[]",keywords:"string[]"},or=t=>{if(!t)return"";try{const e=new Date(t);return new Intl.DateTimeFormat("en-GB",{dateStyle:"medium",timeStyle:"short"}).format(e)}catch{return""}};function cr({quicklinks:t,suggestions:e}){const[n,r]=P.useState(""),[s,o]=P.useState("loading"),[i,c]=P.useState(!1),[a,l]=P.useState([]),[f,u]=P.useState(null),d=P.useRef(null),h=P.useMemo(()=>{if(!n.trim())return e.slice(0,6);const m=n.toLowerCase();return e.filter(g=>g.toLowerCase().includes(m)).slice(0,6)},[n,e]);P.useEffect(()=>{const g=new URLSearchParams(window.location.search).get("q");g&&r(g)},[]),P.useEffect(()=>{const m=new URL(window.location.href),g=n.trim();g?m.searchParams.set("q",g):m.searchParams.delete("q"),window.history.replaceState({},"",m)},[n]),P.useEffect(()=>{let m=!1;return(async()=>{try{o("loading");const S=Un({schema:sr}),b=await fetch("/search-index.json",{cache:"force-cache"});if(!b.ok)throw new Error(`Search index fetch failed (${b.status})`);const I=await b.json();if(await rr(S,I),m)return;d.current=S,o("ready");const w=await fetch("/search-manifest.json",{cache:"force-cache"});if(w.ok){const O=await w.json();m||u(O)}}catch(S){m||(console.error("Failed to bootstrap search",S),o("error"))}})(),()=>{m=!0}},[]),P.useEffect(()=>{const m=n.trim();if(!m){l([]),c(!1);return}if(s!=="ready")return;let g=!1;c(!0);const S=window.setTimeout(async()=>{try{const b=d.current;if(!b)return;const I=await tr(b,{term:m,limit:8,properties:["title","description","keywords"]});if(g)return;const w=I.hits??[];l(w.map(O=>({id:O.document.id,title:O.document.title,description:O.document.description,route:O.document.route,type:O.document.type,badges:O.document.badges??[]})))}catch(b){g||console.error("Search query failed",b)}finally{g||c(!1)}},140);return()=>{g=!0,window.clearTimeout(S)}},[n,s]);const p=n.trim().length>0,y=f?`${f.documents} docs · ${or(f.generatedAt)}`:null;return N.jsxs("div",{className:"glass-panel border border-white/10 px-6 pb-8 pt-5",children:[N.jsxs("form",{className:"flex flex-col gap-4",role:"search","aria-label":"Global search",onSubmit:m=>{m.preventDefault(),a.length>0&&(window.location.href=a[0].route)},children:[N.jsx("label",{htmlFor:"global-search-input",className:"sr-only",children:"Search Wiqnnc_'s Wiki"}),N.jsxs("div",{className:"flex flex-col gap-2",children:[N.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-white/10 bg-[rgba(8,18,34,0.72)] px-4 py-3",children:[N.jsx("span",{className:"text-sm text-white/40",children:"⌘K"}),N.jsx("input",{id:"global-search-input",className:"w-full bg-transparent text-lg font-medium text-white placeholder:text-white/30 focus:outline-none",placeholder:"Search projects, awards, media, facts...",value:n,onChange:m=>r(m.target.value),autoComplete:"off",spellCheck:!1}),n&&N.jsx("button",{type:"button",onClick:()=>r(""),className:"text-xs uppercase tracking-[0.3em] text-white/40 hover:text-white focus:outline-none",children:"Clear"})]}),N.jsxs("div",{className:"flex items-center justify-between text-xs uppercase tracking-[0.35em] text-white/40",children:[N.jsx("span",{children:"Offline index · instant results"}),y?N.jsx("span",{className:"hidden sm:inline-flex",children:y}):null]})]})]}),N.jsxs("div",{className:"mt-6 grid gap-4 md:grid-cols-[1fr_auto] md:items-start",children:[N.jsxs("div",{className:"flex flex-col gap-3",children:[N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-white/40",children:"Suggestions"}),N.jsx("ul",{className:"flex flex-wrap gap-2",children:h.map(m=>N.jsx("li",{children:N.jsx("button",{type:"button",onClick:()=>r(m),className:"rounded-full border border-white/15 px-4 py-2 text-sm text-white/70 transition hover:border-white/40 hover:text-white",children:m})},m))})]}),N.jsxs("div",{className:"flex flex-col gap-3",children:[N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-white/40",children:"Quick Links"}),N.jsx("ul",{className:"flex flex-col gap-2 text-sm text-white/70",children:t.map(m=>N.jsx("li",{children:N.jsxs("a",{href:m.href,className:"flex items-center justify-between gap-4 rounded-xl border border-white/10 bg-white/5 px-4 py-3 transition hover:border-white/30 hover:text-white",children:[N.jsx("span",{children:m.label}),m.badge?N.jsx("span",{className:"rounded border border-white/30 px-2 py-1 text-xs uppercase tracking-[0.3em] text-white/50",children:m.badge}):null]})},m.href))})]})]}),N.jsxs("div",{className:"mt-8 flex flex-col gap-3",children:[N.jsxs("div",{className:"flex items-center justify-between",children:[N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-white/40",children:"Results"}),s==="loading"?N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-white/40",children:"Index loading…"}):null,s==="error"?N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-[#a3485a]",children:"Index unavailable"}):null,s==="ready"&&y?N.jsx("span",{className:"text-xs uppercase tracking-[0.35em] text-white/30 sm:hidden",children:y}):null]}),N.jsxs("div",{className:"flex flex-col gap-3",children:[p?null:N.jsx("p",{className:"text-sm text-white/50",children:"Start typing to surface biography facts, awards, repositories, and media deep links instantly."}),p&&i?N.jsx("p",{className:"text-sm text-white/50",children:"Searching…"}):null,p&&!i&&a.length===0&&s==="ready"?N.jsx("p",{className:"text-sm text-white/50",children:"No matches yet. Try a broader phrase."}):null,N.jsx("ul",{className:"flex flex-col gap-2",children:a.map(m=>N.jsx("li",{children:N.jsxs("a",{href:m.route,className:"flex flex-col gap-2 rounded-xl border border-white/10 bg-white/5 px-4 py-3 transition hover:border-white/30 hover:text-white",children:[N.jsxs("div",{className:"flex items-center justify-between gap-3",children:[N.jsx("span",{className:"font-medium text-white",children:m.title}),N.jsx("span",{className:"text-xs uppercase tracking-[0.3em] text-white/40",children:m.type})]}),N.jsx("p",{className:"text-sm text-white/70",children:m.description}),m.badges.length?N.jsx("div",{className:"flex flex-wrap gap-2 text-xs uppercase tracking-[0.3em] text-white/40",children:m.badges.map(g=>N.jsx("span",{className:"rounded border border-white/20 px-2 py-1 text-white/50",children:g},g))}):null]})},m.id))})]})]})]})}export{cr as default};
